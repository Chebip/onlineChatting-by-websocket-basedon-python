<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>登录界面</title>
<link rel="stylesheet" type="text/css" href="css/login.css" />
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css"/>
<script src="jquery.js"></script>
</head>
<body>
<script>
username = password = null;
    $(document).ready(function(){
        var socket;
        function $$(id) { return document.getElementById(id); }
        function displayContent(msg) {
            $$("txtContent").value += "\r\n" +new Date().Format("yyyy/MM/dd hh:mm:ss")+ ":  " + msg;
        }
        function connect() {
            var host = "ws://192.168.100.2:12345";
            socket = new WebSocket(host);
            try {

                socket.onopen = function (msg) {
                    $('.loginError').html('服务器连接成功！').show().slideUp(3000);
                };

                socket.onmessage = function (msg) {
                    if (typeof msg.data == "string") {
                        displayContent(msg.data);
                    }
                    else {
                        console.log("非文本消息");
                    }
                };

                socket.onclose = function (msg) {
                  $('.loginError').html('服务器中断！').show();
                  };
            }
            catch (ex) {
                log(ex);
            }
        }
        connect();
        function send() {
            var msg = $("#sendText").val();
            socket.send(msg);
        }

        window.onbeforeunload = function () {
            try {
                socket.close();
                socket = null;
            }
            catch (ex) {
            }
        };
        Date.prototype.Format = function (fmt) { //author: meizz
            var o = {
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "h+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        }

        function onkey(event) { if (event.keyCode == 13) { send(); } }
        $('#btnSend').click(function(){send();})
        $('#login #password').focus(function() {
            $('#owl-login').addClass('password');
        }).blur(function() {
            $('#owl-login').removeClass('password');
        });
        $('#loginform').submit(
        	function(){
        		username = $('#email').val();
        		password = $('#password').val();
        		if(!username){
        			$('.loginError').html('用户名不符合规范').show();
        			return false;
        		}
        		if(!password){
        			$('.loginError').html('密码不符合规范').show();
        			return false;
        		}
        		$('#floatDiv').fadeOut(500);
        		$('.userInfo').html(username);
        		return false;
        	});
    });
</script>
<style>
    #floatDiv{
    top:0;
    z-index:100;
    height:100%;
    width:100%;
    position:fixed;
    background:#0a3a42;
    background-image: url(images/bg.png);
    background-size: 100% 100%;
    }
    #chat{
    margin-left: 23%;
    }
    .language-option {
    position: absolute;
    z-index: 2000;
    left: 50px;
    bottom: 36px;
    color: rgba(255, 255, 255, 0.6);
    font-size: 13px;
}
.language-option .language-option-item {
    cursor: pointer;
    padding: 0 10px;
    border-right: 1px solid rgba(255, 255, 255, 0.6);
}
.networkdetect {
    position: absolute;
    z-index: 2000;
    right: 50px;
    bottom: 36px;
    color: rgba(255, 255, 255, 0.6);
    font-size: 13px;
    cursor: pointer;
}
</style>
<div id="chat">
    <h3>Username:<span class="userInfo"></span></h3>
        <div id="chatContent">
            <div>
                <input id="sendText" type="text" placeholder="发送文本" value="" />
                <input id="btnSend" type="button" value="发送"  />
            </div>
            <div>
                <div>
                    来自服务端的消息
                </div>
                <textarea id="txtContent" cols="50" rows="10" readonly="readonly"></textarea>
            </div>
        </div>
</div>
<div id="floatDiv">
    <div id="login">
    <div class="wrapper">
        <div class="login">
            <form action="" method="post" class="container offset1 loginform" id="loginform">
                <div id="owl-login">
                    <div class="hand"></div>
                    <div class="hand hand-r"></div>
                    <div class="arms">
                        <div class="arm"></div>
                        <div class="arm arm-r"></div>
                    </div>
                </div>
                <div class="pad">
                    <h2 style="text-align: center;color:olive">Halo-Hello</h2>
                <p class="error loginError" align="center"></p>
                    <div class="control-group">
                        <div class="controls">
                            <label for="email" class="control-label  fa fa-envelope"></label>
                            <input id="email" type="text" name="email" placeholder="Username" tabindex="1" autofocus="autofocus" class="form-control input-medium">
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="controls">
                            <label for="password" class="control-label fa fa-asterisk"></label>
                            <input id="password" type="password" name="password" placeholder="Password" tabindex="2" class="form-control input-medium">
                        </div>
                    </div>
                    <div class="control-group" style="display:none">
                        <div class="controls">
                            <label for="password" class="control-label"></label>
                            <input id="password" type="password" name="password" placeholder="Confirm Password" tabindex="2" class="form-control input-medium">
                        </div>
                    </div>
                </div>
                <div class="form-actions"><a href="javascript:void(0)" tabindex="5" class="btn pull-left btn-link text-muted">Forgot password?</a><a href="javascript:void(0)" tabindex="6" class="btn btn-link text-muted">Sign Up</a>
                    <button type="submit" tabindex="4" class="btn btn-primary">Login</button>
                </div>
            </form>
        </div>
    </div>
</div>
    <div class="language-option">
        <span class="language-option-item ng-binding ng-scope" ng-repeat="lang in login.LANGS track by lang.type" ng-click="login.changeLng(lang.type)">简体中文</span>
        <span class="language-option-item ng-binding ng-scope" ng-repeat="lang in login.LANGS track by lang.type" ng-click="login.changeLng(lang.type)">繁體中文</span>
        <span class="language-option-item ng-binding ng-scope" ng-repeat="lang in login.LANGS track by lang.type" ng-click="login.changeLng(lang.type)">English</span>
    </div>
    <div class="networkdetect ng-binding" ng-click="login.networkdetect()">登录异常? 点此检测</div>
</div>
</body>
</html>